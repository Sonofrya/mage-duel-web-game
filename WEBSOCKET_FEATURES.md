# WebSocket функции для Mage Game

## Реализованные функции

### 1. Обновление игрового поля через WebSocket

**Файл:** `js/game.js`

**Функции:**
- `sendGameUpdate()` - отправляет обновления игры всем игрокам в комнате
- `updateGameField()` - обрабатывает обновления игрового поля
- `showPlayerCardsNotification()` - показывает уведомления о сыгранных картах

**Типы обновлений:**
- `playerStats` - обновление статистики игроков
- `gameFieldUpdate` - обновление игрового поля после завершения хода
- `phaseChange` - смена фазы игры
- `playerAction` - действия игроков

### 2. Модальное окно победителя

**Файл:** `js/game.js`

**Функция:** `showWinnerWindow(winnerId, winnerName)`

**Особенности:**
- Показывается всем игрокам в комнате
- Красивый дизайн с анимациями
- Кнопки "Вернуться в меню" и "Покинуть комнату"
- Обратный отсчет (15 секунд)
- Автоматическое перенаправление в меню

### 3. WebSocket сервер

**Файл:** `server.php`

**Обработчики сообщений:**
- `joinRoom` - присоединение к комнате
- `leaveRoom` - выход из комнаты
- `gameUpdate` - обновления игры
- `gameEnd` - завершение игры
- `playerAction` - действия игроков

### 4. Тестирование WebSocket

**Файл:** `websocket_test.html`

**Возможности:**
- Подключение/отключение от WebSocket сервера
- Отправка тестовых сообщений
- Просмотр входящих сообщений
- Тестирование различных типов сообщений

## Как использовать

### Запуск WebSocket сервера

```bash
php server.php
```

Сервер запустится на `ws://localhost:8080`

### Тестирование

1. Откройте `websocket_test.html` в браузере
2. Нажмите "Подключиться"
3. Используйте кнопки для отправки тестовых сообщений

### В игре

1. После завершения хода игровое поле автоматически обновляется у всех игроков
2. При завершении игры модальное окно победителя показывается всем игрокам
3. Уведомления о действиях других игроков отображаются в правом верхнем углу

## Структура сообщений

### gameUpdate
```json
{
    "type": "gameUpdate",
    "room_id": 1,
    "updateType": "gameFieldUpdate",
    "data": {
        "players": {...},
        "cardsPlayed": {...},
        "player": "player_name",
        "timestamp": 1234567890
    }
}
```

### gameEnd
```json
{
    "type": "gameEnd",
    "room_id": 1,
    "winner": 123,
    "winnerName": "Player Name"
}
```

### playerAction
```json
{
    "type": "playerAction",
    "room_id": 1,
    "player": "player_name",
    "action": "cardPlayed",
    "data": {
        "cards": {...},
        "player": "player_name"
    }
}
```

## Безопасность

- Все сообщения проверяются на валидность
- Комнаты изолированы друг от друга
- Автоматическая очистка комнат после завершения игры
- Обработка ошибок подключения с автоматическим переподключением
